# name: Evaluate Submission

# on:
#   pull_request_target:
#     types: [opened, synchronize]
#     paths:
#       # - "submission/*.csv"
#       - "submission/*.enc"

# permissions:
#   contents: write
#   pull-requests: write

# jobs:
#   evaluate:
#     runs-on: ubuntu-latest

#     steps:
#       # 1️⃣ Debug trigger
#       - name: Debug 
#         run: echo Triggered for PR ${{ github.event.pull_request.number }}

#       # 2️⃣ Checkout PR branch (submission only)
#       - name: Checkout PR branch
#         uses: actions/checkout@v4
#         with:
#           repository: ${{ github.event.pull_request.head.repo.full_name }}
#           ref: ${{ github.event.pull_request.head.ref }}
#           path: pr_repo

#       # 3️⃣ Checkout MAIN branch (latest leaderboard)
#       - name: Checkout main branch
#         uses: actions/checkout@v4
#         with:
#           ref: main
#           path: main_repo
#           fetch-depth: 0
      
#       # 4️⃣ Checkout private repo (true labels)
#       - name: Checkout private repo
#         uses: actions/checkout@v4
#         with:
#           repository: Tasneem-Selim-Researcher/GNN_CoRA_Competition_private
#           token: ${{ secrets.PRIVATE_REPO_TOKEN }}
#           path: private_data

#       # 5️⃣ Setup Python
#       - name: Setup Python
#         uses: actions/setup-python@v5
#         with:
#           python-version: "3.10"

#       - name: Install dependencies
#         # run: pip install pandas scikit-learn numpy
#         run: pip install pandas scikit-learn numpy cryptography

#       # 6️⃣ Copy submission into main repo workspace
#       # - name: Copy submission file
#       #   run: |
#       #     cp pr_repo/submission/*.csv main_repo/submission/
#       - name: Copy encrypted submission
#         run: |
#             cp pr_repo/submission/*.enc main_repo/

#       # 7️⃣ Run evaluation using MAIN leaderboard
#       # - name: Evaluate submission
#       #   run: |
#       #     cd main_repo
#       #     FILE=$(ls submission/*.csv | tail -n 1)
#       #     echo "Evaluating $FILE"
#       #     python evaluate.py "$FILE" "../private_data/test_labels_only.csv"

#       - name: Decrypt submission
#         env:
#           PRIVATE_KEY: ${{ secrets.PRIVATE_KEY }}
#         run: |
#             cd main_repo
#             FILE=$(ls *.enc | tail -n 1)
#             echo "Decrypting $FILE"
#             python encryption/decrypt_submission.py "$FILE" decrypted_submission.csv

#       - name: Evaluate submission
#         run: |
#             cd main_repo
#             echo "Evaluating decrypted_submission.csv"
#             python evaluate.py decrypted_submission.csv "../private_data/test_labels_only.csv"

#       - name: Generate leaderboard HTML
#         run: |
#           cd main_repo
#           python generate_leaderboard_html.py
          
#       # 8️⃣ Commit updated leaderboard to main
#       - name: Push leaderboard to main
#         run: |
#           cd main_repo
#           git config user.name "github-actions"
#           git config user.email "actions@github.com"

#           git add final_leaderboard.csv final_leaderboard.html

#           if ! git diff --cached --quiet; then
#             git commit -m "Update leaderboard from PR #${{ github.event.pull_request.number }}"
#             git pull --rebase origin main
#             git push origin HEAD:main
#           else
#             echo "No leaderboard changes to commit"
#           fi
